@namespace RepositoryFramework.Web.Components.Standard
@typeparam T
@typeparam TKey where TKey: notnull
@inherits RepositoryBase<T, TKey>

<RadzenDataGrid Data="@_entities"
                Count="@_totalItems"
                LoadData="@OnReadData"
                TItem="Entity<T, TKey>"
                AllowVirtualization="false"
                FilterMode="FilterMode.Advanced"
                PageSize="@PageSize"
                IsLoading="@_isLoading"
                AllowFiltering="true"
                ColumnWidth="@AppSettings.Sizing.ColumnWidth"
                AllowColumnResize="true"
                Style="min-height:400px"
                FilterCaseSensitivity="FilterCaseSensitivity.Default"
                LogicalFilterOperator="LogicalFilterOperator.Or"
                PageSizeOptions="s_pageSizeOptions"
                PageSizeChanged="@((x) => PageSize = x)"
                AllowColumnPicking="true"
                AllowPaging="true"
                AllowSorting="true">
    <Columns>
        <RadzenDataGridColumn TItem="Entity<T, TKey>" Property="Key" Title="Key" Frozen="true">
            <Template Context="context">
                <RadzenLink Path="@GetEditUri(context.Key!)" Text="@GetKey(context)" />
            </Template>
        </RadzenDataGridColumn>
        @foreach (var value in TypeShowcase.FlatProperties)
        {
            if (value.Type != PropertyType.Enumerable)
            {
                <RadzenDataGridColumn TItem="Entity<T, TKey>" Property="@value.NavigationPath" Title="@value.NavigationPath" Sortable="true">
                    <Template Context="context">
                        <CopyButton GetValue="@(() => value.Value(context.Value))" />
                    </Template>
                </RadzenDataGridColumn>
            }
            else
            {
                <RadzenDataGridColumn TItem="Entity<T, TKey>" Property="@value.NavigationPath" Title="@value.NavigationPath" Sortable="true" Filterable="false">
                    <Template Context="context">
                        <RadzenButton class="bg-transparent text-dark p-0"
                              Click="@((x) => ShowMoreValuesAsync(context.Value, value))"
                              Text="@EnumerableCountAsString(context.Value, value)" />
                    </Template>
                </RadzenDataGridColumn>
            }
        }
    </Columns>
</RadzenDataGrid>
